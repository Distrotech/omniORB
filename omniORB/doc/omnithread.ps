%!PS-Adobe-2.0
%%Creator: dvips(k) 5.92b Copyright 2002 Radical Eye Software
%%Title: omnithread.dvi
%%Pages: 7
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Palatino-Roman Palatino-Italic Palatino-Bold CMSY10
%%+ Courier
%%DocumentPaperSizes: A4
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips omnithread
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 2005.07.19:1055
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% File  8r.enc as of 2002-03-12 for PSNFSS 9
%
% This is the encoding vector for Type1 and TrueType fonts to be used
% with TeX.  This file is part of the PSNFSS bundle, version 9
% 
% Authors: S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry, W. Schmidt
%
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida + Euro.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
%
% (6) /Euro is assigned to 128, as in Windows ANSI
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /Euro /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: bbad153f.enc
% Thomas Esser, Dec 2002. public domain
%
% Encoding for:
%     cmsy10 cmsy5 cmsy6 cmsy7 cmsy8 cmsy9
%
/TeXbbad153fEncoding [
/minus /periodcentered /multiply /asteriskmath /divide /diamondmath
/plusminus /minusplus /circleplus /circleminus /circlemultiply
/circledivide /circledot /circlecopyrt /openbullet /bullet
/equivasymptotic /equivalence /reflexsubset /reflexsuperset /lessequal
/greaterequal /precedesequal /followsequal /similar /approxequal
/propersubset /propersuperset /lessmuch /greatermuch /precedes /follows
/arrowleft /arrowright /arrowup /arrowdown /arrowboth /arrownortheast
/arrowsoutheast /similarequal /arrowdblleft /arrowdblright /arrowdblup
/arrowdbldown /arrowdblboth /arrownorthwest /arrowsouthwest /proportional
/prime /infinity /element /owner /triangle /triangleinv /negationslash
/mapsto /universal /existential /logicalnot /emptyset /Rfractur /Ifractur
/latticetop /perpendicular /aleph /A /B /C /D /E /F /G /H /I /J /K
/L /M /N /O /P /Q /R /S /T /U /V /W /X /Y /Z /union /intersection
/unionmulti /logicaland /logicalor /turnstileleft /turnstileright
/floorleft /floorright /ceilingleft /ceilingright /braceleft /braceright
/angbracketleft /angbracketright /bar /bardbl /arrowbothv /arrowdblbothv
/backslash /wreathproduct /radical /coproduct /nabla /integral
/unionsq /intersectionsq /subsetsqequal /supersetsqequal /section
/dagger /daggerdbl /paragraph /club /diamond /heart /spade /arrowleft
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/minus /periodcentered /multiply /asteriskmath /divide /diamondmath
/plusminus /minusplus /circleplus /circleminus /.notdef /.notdef
/circlemultiply /circledivide /circledot /circlecopyrt /openbullet
/bullet /equivasymptotic /equivalence /reflexsubset /reflexsuperset
/lessequal /greaterequal /precedesequal /followsequal /similar
/approxequal /propersubset /propersuperset /lessmuch /greatermuch
/precedes /follows /arrowleft /spade /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]FontType 0
ne{/Metrics exch def dict begin Encoding{exch dup type/integertype ne{
pop pop 1 sub dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get
div def}ifelse}forall Metrics/Metrics currentdict end def}{{1 index type
/nametype eq{exit}if exch pop}loop}ifelse[2 index currentdict end
definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{dup
sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1 roll
mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def dup[
exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}if}
forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}def
end

%%EndProcSet
%%BeginFont: CMSY10
%!PS-AdobeFont-1.1: CMSY10 1.0
%%CreationDate: 1991 Aug 15 07:20:57
% Copyright (C) 1997 American Mathematical Society. All Rights Reserved.
11 dict begin
/FontInfo 7 dict dup begin
/version (1.0) readonly def
/Notice (Copyright (C) 1997 American Mathematical Society. All Rights Reserved) readonly def
/FullName (CMSY10) readonly def
/FamilyName (Computer Modern) readonly def
/Weight (Medium) readonly def
/ItalicAngle -14.035 def
/isFixedPitch false def
end readonly def
/FontName /CMSY10 def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding 256 array
0 1 255 {1 index exch /.notdef put} for
dup 0 /.notdef put
readonly def
/FontBBox{-29 -960 1116 775}readonly def
/UniqueID 5000820 def
currentdict end
currentfile eexec
D9D66F633B846A97B686A97E45A3D0AA052F09F9C8ADE9D907C058B87E9B6964
7D53359E51216774A4EAA1E2B58EC3176BD1184A633B951372B4198D4E8C5EF4
A213ACB58AA0A658908035BF2ED8531779838A960DFE2B27EA49C37156989C85
E21B3ABF72E39A89232CD9F4237FC80C9E64E8425AA3BEF7DED60B122A52922A
221A37D9A807DD01161779DDE7D31FF2B87F97C73D63EECDDA4C49501773468A
27D1663E0B62F461F6E40A5D6676D1D12B51E641C1D4E8E2771864FC104F8CBF
5B78EC1D88228725F1C453A678F58A7E1B7BD7CA700717D288EB8DA1F57C4F09
0ABF1D42C5DDD0C384C7E22F8F8047BE1D4C1CC8E33368FB1AC82B4E96146730
DE3302B2E6B819CB6AE455B1AF3187FFE8071AA57EF8A6616B9CB7941D44EC7A
71A7BB3DF755178D7D2E4BB69859EFA4BBC30BD6BB1531133FD4D9438FF99F09
4ECC068A324D75B5F696B8688EEB2F17E5ED34CCD6D047A4E3806D000C199D7C
515DB70A8D4F6146FE068DC1E5DE8BC5703711DA090312BA3FC00A08C453C609
C627A8BECD6E1FA14A3B02476E90AAD8B4700C400380BC9AFFBF7847EB28661B
9DC3AA0F44C533F2E07DCC4DE19D367BF223E33DC321D0247A0E6EF6ABC8FA52
15AE044094EF678A8726CD7C011F02BFF8AB6EAEEE391AD837120823BED0B5D8
F8B15245377871A64F78378BB4330149D6941F7A86FBFFC49B93C94155F5FA7D
F22E7214511C0A92693F4CDBF38411651540572F2DD70D924AE0F18E1CD581F3
C871399127FF5D07A868885B5FF7CDEB50B8323B2533DEF8DC973B1AE84FA0A2

0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark
%%EndFont 
TeXDict begin 39158280 55380996 1000 600 600 (omnithread.dvi)
@start /Fa 134[45 45 66 1[51 30 35 35 1[45 40 51 71 25
2[25 45 45 25 35 45 37 42 40 8[66 3[56 51 2[56 71 5[30
3[56 3[66 23[30 30 40[{ TeXBase1Encoding ReEncodeFont }31
90.9091 /Palatino-Italic rf /Fb 134[51 1[76 1[56 30 40
35 2[51 56 81 30 2[30 56 51 35 45 56 40 56 45 14[66 2[76
5[35 6[61 19[23 30 23 4[25 39[{ TeXBase1Encoding ReEncodeFont }27
90.9091 /Palatino-Bold rf /Fc 135[50 83 1[61 33 44 39
1[61 55 61 89 33 2[33 61 55 1[50 61 44 61 50 10[78 8[100
9[72 12[50 1[50 50 50 50 2[25 4[33 33 40[{
 TeXBase1Encoding ReEncodeFont }30 99.6264 /Palatino-Bold
rf /Fd 134[55 55 55 55 55 55 55 55 55 55 55 55 55 55
55 55 55 55 55 55 55 55 55 55 55 1[55 5[55 55 55 55 55
55 55 55 1[55 55 55 55 55 55 1[55 55 55 55 55 55 55 55
55 3[55 2[55 1[55 1[55 55 55 55 55 55 55 1[55 55 55 1[55
55 55 40[{ TeXBase1Encoding ReEncodeFont }65 90.9091
/Courier rf /Fe 141[36 12[44 56 2[45 7[61 61 91 1[71
56 48 61 2[71 76 3[30 31 76 1[51 56 70 64 56 71 10[45
3[45 45 1[55 23 4[30 30 40[{
 .167 SlantFont TeXBase1Encoding ReEncodeFont }29 90.9091
/Palatino-Roman rf /Ff 240[45 15[{ TeXbbad153fEncoding ReEncodeFont }1
90.9091 /CMSY10 rf /Fg 104[91 2[45 45 24[45 51 47 76
51 55 30 39 36 51 55 50 53 80 26 51 21 26 53 51 30 44
56 40 50 45 3[30 1[30 2[61 91 66 71 56 48 61 1[55 71
76 86 56 66 30 31 76 1[51 56 70 64 56 71 6[23 45 45 45
45 45 45 45 45 45 45 55 23 30 23 55 1[30 30 25 4[34 30[55
55 2[{ TeXBase1Encoding ReEncodeFont }75 90.9091 /Palatino-Roman
rf /Fh 134[66 60 100 1[73 40 53 47 1[73 66 73 106 2[40
40 73 66 47 60 73 53 73 60 11[93 80 73 86 1[73 100 100
120 3[47 18[60 60 60 60 60 60 1[35 1[40 45[{
 TeXBase1Encoding ReEncodeFont }38 119.552 /Palatino-Bold
rf /Fi 137[50 2[39 9[28 3[39 50 17[66 82[{
 TeXBase1Encoding ReEncodeFont }6 99.6264 /Palatino-Italic
rf /Fj 137[56 1[32 42 39 2[54 58 88 3[29 58 55 1[48 61
44 55 50 12[61 1[67 3[83 1[61 8[71 1[78 14[50 50 50 9[78
38[{ TeXBase1Encoding ReEncodeFont }25 99.6264 /Palatino-Roman
rf /Fk 139[47 61 57 2[78 83 4[42 83 2[69 88 64 79 72
12[88 4[113 119 136 3[48 7[112 65[{ TeXBase1Encoding ReEncodeFont }18
143.462 /Palatino-Roman rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4
 end
%%EndSetup
%%Page: 1 1
TeXDict begin 1 0 bop 728 918 a Fk(The)36 b(OMNI)g(Thr)m(ead)f
(Abstraction)1293 1176 y Fj(T)-9 b(ristan)26 b(Richar)n(dson)1022
1293 y(A)-7 b(T&T)24 b(Laboratories)i(Cambridge)1192
1504 y Fi(Revised)e Fj(November)h(2001)63 1961 y Fh(1)119
b(Introduction)63 2183 y Fg(The)20 b(OMNI)h(thr)n(ead)g(abstraction)g
(is)h(designed)d(to)h(pr)n(ovide)h(a)h(common)f(set)f(of)h(thr)n(ead)g
(oper)n(-)63 2296 y(ations)h(for)g(use)g(in)h(pr)n(ograms)f(written)f
(in)i(C++.)29 b(Pr)n(ograms)22 b(written)g(using)f(the)h(abstraction)63
2409 y(should)30 b(be)g(much)i(easier)e(to)g(port)g(between)f(dif)n
(fer)n(ent)i(ar)n(chitectur)n(es)g(with)g(dif)n(fer)n(ent)f(un-)63
2522 y(derlying)21 b(thr)n(eads)h(primitives.)204 2640
y(The)17 b(pr)n(ogramming)h(interface)g(is)f(designed)f(to)h(be)h
(similar)h(to)e(the)g(C)i(language)e(interface)63 2753
y(to)k(POSIX)h(thr)n(eads)f(\(IEEE)g(draft)h(standar)n(d)f(1003.1c)k
(\227)d(pr)n(eviously)g(1003.4a,)i(often)e(known)63 2866
y(as)g(\223pthr)n(eads\224)h([POSIX94]\).)204 2985 y(Much)18
b(of)f(the)g(abstraction)i(consists)d(of)i(simple)g(C++)g(object)g
(wrappers)e(ar)n(ound)h(pthr)n(ead)63 3098 y(calls.)28
b(However)18 b(for)h(some)f(featur)n(es)g(such)h(as)h(thr)n
(ead-speci\002c)f(data,)h(a)f(better)f(interface)i(can)63
3211 y(be)i(of)n(fer)n(ed)g(because)h(of)f(the)g(use)g(of)g(C++.)204
3329 y(Some)28 b(of)h(the)f(mor)n(e)h(complex)f(featur)n(es)g(of)h
(pthr)n(eads)f(ar)n(e)h(not)f(supported)e(because)j(of)63
3442 y(the)e(dif)n(\002culty)i(of)f(ensuring)g(the)f(same)h(featur)n
(es)g(can)h(be)f(of)n(fer)n(ed)g(on)g(top)g(of)g(other)f(thr)n(ead)63
3555 y(systems.)d(Such)17 b(featur)n(es)g(include)h(thr)n(ead)f
(cancellation)i(and)f(complex)g(scheduling)f(contr)n(ol)63
3668 y(\(though)k(simple)i(thr)n(ead)f(priorities)g(ar)n(e)h
(supported\).)204 3787 y(The)i(abstraction)h(layer)h(is)f(curr)n(ently)
f(implemented)g(for)h(the)f(following)i(ar)n(chitectur)n(es)63
3900 y(/)22 b(thr)n(ead)h(systems:)199 4141 y Ff(\017)46
b Fg(Solaris)23 b(2.x)g(using)f(pthr)n(eads)f(draft)h(10)199
4351 y Ff(\017)46 b Fg(Solaris)23 b(2.x)g(using)f(solaris)g(thr)n(eads)
g(\(but)h(pthr)n(eads)e(version)h(is)h(now)f(standar)n(d\))199
4561 y Ff(\017)46 b Fg(Alpha)23 b(OSF1)g(using)f(pthr)n(eads)f(draft)i
(4)199 4772 y Ff(\017)46 b Fg(W)-5 b(indows)21 b(NT)h(using)g(NT)g(thr)
n(eads)199 4982 y Ff(\017)46 b Fg(Linux)22 b(2.x)h(using)f(Linuxthr)n
(ead)g(0.5)h(\(which)h(is)e(based)g(on)h(pthr)n(eads)e(draft)i(10\))199
5193 y Ff(\017)46 b Fg(Linux)22 b(2.x)h(using)f(MIT)g(pthr)n(eads)f
(\(which)j(is)f(based)f(on)g(draft)h(8\))199 5403 y Ff(\017)46
b Fg(A)-7 b(TMos)22 b(using)g(pthr)n(eads)f(draft)h(6)i(\(but)e(not)g
(V)-5 b(irata)23 b(A)-7 b(TMos\))1684 5652 y(1)p eop
end
%%Page: 2 2
TeXDict begin 2 1 bop 221 249 a Fg(2)1797 b Fe(2)91 b(SYNCHRONISA)-7
b(TION)20 b(OBJECTS)362 548 y Fg(See)j(the)f Fd(omnithread.h)c
Fg(header)k(\002le)i(for)f(full)i(details)e(of)g(the)g(API.)f(The)h
(descriptions)221 661 y(below)35 b(assume)g(you)g(have)h(some)e(pr)n
(evious)h(knowledge)e(of)j(thr)n(eads,)h(mutexes,)g(condi-)221
774 y(tion)h(variables)i(and)e(semaphor)n(es.)73 b(Also)38
b(r)n(efer)f(to)h(other)f(documentation)g(\([Birr)n(ell89)r(],)221
887 y([POSIX94)q(]\))22 b(for)g(further)f(explanation)i(of)f(these)e
(ideas)i(\(particularly)h(condition)f(variables,)221
1000 y(the)g(use)g(of)g(which)h(may)g(not)f(be)h(particularly)h
(intuitive)f(when)f(\002rst)f(encounter)n(ed\).)221 1299
y Fh(2)119 b(Synchronisation)31 b(objects)221 1510 y
Fg(Synchr)n(onisation)26 b(objects)h(ar)n(e)g(used)e(to)h(synchr)n
(onise)g(thr)n(eads)g(within)h(the)f(same)h(pr)n(ocess.)221
1623 y(Ther)n(e)j(is)i(no)f(inter)n(-pr)n(ocess)f(synchr)n(onisation)g
(pr)n(ovided.)53 b(The)30 b(synchr)n(onisation)h(objects)221
1735 y(pr)n(ovided)22 b(ar)n(e)h(mutexes,)e(condition)h(variables)i
(and)f(counting)f(semaphor)n(es.)221 1991 y Fc(2.1)99
b(Mutex)221 2168 y Fg(An)21 b(object)f(of)h(type)e Fd(omni_mutex)e
Fg(is)j(used)g(for)g(mutual)i(exclusion.)27 b(It)20 b(pr)n(ovides)g
(two)g(oper)n(-)221 2281 y(ations,)e Fd(lock\(\))c Fg(and)k
Fd(unlock\(\))p Fg(.)k(The)17 b(alternative)g(names)g
Fd(acquire\(\))c Fg(and)k Fd(release\(\))221 2393 y Fg(can)29
b(be)f(used)f(if)i(pr)n(eferr)n(ed.)43 b(Behaviour)28
b(is)h(unde\002ned)d(when)h(a)i(thr)n(ead)f(attempts)e(to)i(lock)221
2506 y(the)21 b(same)h(mutex)g(again)h(or)e(when)h(a)g(mutex)g(is)g
(locked)f(by)h(one)f(thr)n(ead)h(and)g(unlocked)f(by)g(a)221
2619 y(dif)n(fer)n(ent)i(thr)n(ead.)221 2874 y Fc(2.2)99
b(Condition)26 b(V)-11 b(ariable)221 3051 y Fg(A)28 b(condition)f
(variable)j(is)e(r)n(epr)n(esented)d(by)j(an)g Fd(omni_condition)21
b Fg(and)28 b(is)g(used)e(for)i(sig-)221 3164 y(nalling)22
b(between)c(thr)n(eads.)26 b(A)21 b(call)h(to)d Fd(wait\(\))f
Fg(causes)i(a)h(thr)n(ead)e(to)h(wait)h(on)f(the)f(condition)221
3277 y(variable.)47 b(A)28 b(call)i(to)d Fd(signal\(\))e
Fg(wakes)i(up)h(at)g(least)g(one)f(thr)n(ead)h(if)h(any)f(ar)n(e)g
(waiting.)45 b(A)221 3390 y(call)25 b(to)d Fd(broadcast\(\))17
b Fg(wakes)22 b(up)g(all)i(thr)n(eads)e(waiting)h(on)f(the)g(condition)
g(variable.)362 3503 y(When)30 b(constr)o(ucted,)g(a)g(pointer)f(to)h
(an)g Fd(omni_mutex)c Fg(must)j(be)h(given.)50 b(A)30
b(condition)221 3616 y(variable)35 b Fd(wait\(\))c Fg(has)i(an)h
(implicit)h(mutex)e Fd(unlock\(\))d Fg(and)j Fd(lock\(\))e
Fg(ar)n(ound)i(it.)60 b(The)221 3729 y(link)30 b(between)f(condition)g
(variable)j(and)e(mutex)f(lasts)g(for)h(the)f(lifetime)i(of)e(the)g
(condition)221 3842 y(variable)e(\(unlike)f(pthr)n(eads)e(wher)n(e)g
(the)h(link)h(is)f(only)g(for)g(the)g(duration)f(of)i(the)e(wait\).)37
b(The)221 3955 y(same)23 b(mutex)f(may)h(be)f(used)f(with)i(several)f
(condition)h(variables.)362 4068 y(A)c(wait)g(with)g(a)g(timeout)f(can)
i(be)e(achieved)h(by)g(calling)i Fd(timed_wait\(\))p
Fg(.)g(This)d(is)h(given)221 4181 y(an)27 b(absolute)e(time)h(to)f
(wait)h(until.)38 b(The)26 b(r)n(outine)f Fd(omni_thread::g)o(et_)o(ti)
o(me)o(\(\))19 b Fg(can)27 b(be)221 4293 y(used)21 b(to)h(turn)g(a)h(r)
n(elative)h(time)e(into)h(an)g(absolute)f(time.)28 b
Fd(timed_wait\(\))17 b Fg(r)n(eturns)k Fd(true)g Fg(if)221
4406 y(the)27 b(condition)h(was)g(signalled,)h Fd(false)d
Fg(if)j(the)f(time)g(expir)n(ed)f(befor)n(e)g(the)h(condition)f(vari-)
221 4519 y(able)d(was)e(signalled.)221 4774 y Fc(2.3)99
b(Counting)26 b(semaphores)221 4951 y Fg(An)21 b Fd(omni_semaphore)14
b Fg(is)21 b(a)h(counting)e(semaphor)n(e.)26 b(When)20
b(cr)n(eated)g(it)h(is)g(given)g(an)g(initial)221 5064
y(unsigned)j(integer)g(value.)36 b(When)25 b Fd(wait\(\))d
Fg(is)k(called,)g(the)f(value)h(is)f(decr)n(emented)e(if)j(non-)221
5177 y(zer)n(o.)43 b(If)27 b(the)g(value)h(is)f(zer)n(o)h(then)f(the)f
(thr)n(ead)h(blocks)h(instead.)41 b(When)27 b Fd(post\(\))e
Fg(is)i(called,)221 5290 y(if)h(any)g(thr)n(eads)e(ar)n(e)i(blocked)f
(in)g Fd(wait\(\))p Fg(,)f(exactly)h(one)g(thr)n(ead)g(is)g(woken.)41
b(If)27 b(no)g(thr)n(eads)221 5403 y(wer)n(e)22 b(blocked)g(then)g(the)
g(value)h(of)g(the)e(semaphor)n(e)h(is)h(incr)n(emented.)p
eop end
%%Page: 3 3
TeXDict begin 3 2 bop 3306 249 a Fg(3)204 548 y(If)27
b(a)h(thr)n(ead)e(calls)j Fd(try_wait\(\))p Fg(,)23 b(then)k(the)f(thr)
n(ead)g(won't)h(block)h(if)f(the)g(semaphor)n(e's)63
661 y(value)c(is)g(0,)g(r)n(eturning)e Fd(false)g Fg(instead.)204
777 y(Ther)n(e)h(is)g(no)h(way)f(of)h(querying)e(the)h(value)h(of)g
(the)f(semaphor)n(e.)63 1095 y Fh(3)119 b(Thread)29 b(object)63
1313 y Fg(A)23 b(thr)n(ead)g(is)h(r)n(epr)n(esented)c(by)k(an)g
Fd(omni_thread)19 b Fg(object.)30 b(Ther)n(e)23 b(ar)n(e)h(br)n(oadly)g
(two)e(dif)n(fer)n(-)63 1426 y(ent)f(ways)i(in)g(which)g(it)g(can)g(be)
g(used.)204 1542 y(The)28 b(\002rst)g(way)h(is)h(simply)f(to)f(cr)n
(eate)h(an)h Fd(omni_thread)24 b Fg(object,)30 b(giving)g(a)f
(particular)63 1655 y(function)c(which)h(the)e(thr)n(ead)h(should)f
(execute.)34 b(This)25 b(is)g(like)g(the)g(POSIX)f(\(or)i(any)f
(other\))f(C)63 1768 y(language)e(interface.)204 1884
y(The)k(second)f(method)h(of)h(use)e(is)i(to)f(cr)n(eate)h(a)g(new)g
(class)g(which)g(inherits)f(fr)n(om)i Fd(omni_)63 1997
y(thread)p Fg(.)48 b(In)31 b(this)f(case)g(the)g(thr)n(ead)g(will)i
(execute)d(the)g Fd(run\(\))g Fg(member)h(function)h(of)f(the)63
2109 y(new)22 b(class.)29 b(One)23 b(advantage)g(of)g(this)g(scheme)f
(is)h(that)g(thr)n(ead-speci\002c)g(data)g(can)h(be)f(imple-)63
2222 y(mented)e(simply)h(by)h(having)g(data)g(members)f(of)h(the)f(new)
g(class.)204 2339 y(When)f(constr)o(ucted)g(a)i(thr)n(ead)f(is)g(in)h
(the)e("new")h(state)f(and)h(has)g(not)g(actually)i(started.)i(A)63
2451 y(call)31 b(to)e Fd(start\(\))d Fg(causes)j(the)g(thr)n(ead)g(to)g
(begin)g(executing.)47 b(A)29 b(static)h(member)f(function)63
2564 y Fd(create\(\))f Fg(is)k(pr)n(ovided)f(to)g(constr)o(uct)g(and)g
(start)g(a)i(thr)n(ead)e(in)h(a)g(single)g(call.)57 b(A)31
b(thr)n(ead)63 2677 y(exits)21 b(by)i(calling)h Fd(exit\(\))c
Fg(or)j(by)f(r)n(eturning)g(fr)n(om)h(the)f(thr)n(ead)g(function.)204
2793 y(Thr)n(eads)27 b(can)j(be)e(either)g(detached)f(or)h(undetached.)
44 b(Detached)28 b(thr)n(eads)g(ar)n(e)h(thr)n(eads)63
2906 y(for)h(which)i(all)g(state)e(will)i(be)f(lost)f(upon)g(exit.)52
b(Other)30 b(thr)n(eads)g(cannot)h(determine)e(when)63
3019 y(a)g(detached)f(thr)n(ead)h(will)h(disappear)-7
b(,)31 b(and)e(ther)n(efor)n(e)f(should)g(not)h(attempt)f(to)g(access)h
(the)63 3132 y(thr)n(ead)23 b(object)g(unless)f(some)h(explicit)h
(synchr)n(onisation)f(with)g(the)g(detached)f(thr)n(ead)h(guar)n(-)63
3245 y(antees)e(that)h(it)h(still)g(exists.)204 3361
y(Undetached)31 b(thr)n(eads)h(ar)n(e)i(thr)n(eads)e(for)h(which)g
(storage)f(is)h(not)f(r)n(eclaimed)i(until)g(an-)63 3474
y(other)e(thr)n(ead)i(waits)g(for)g(its)g(termination)g(by)g(calling)i
Fd(join\(\))p Fg(.)59 b(An)34 b(exit)g(value)h(can)g(be)63
3587 y(passed)21 b(fr)n(om)i(an)g(undetached)e(thr)n(ead)h(to)g(the)g
(thr)n(ead)g(which)h(joins)g(it.)204 3703 y(Detached)31
b(/)h(undetached)e(thr)n(eads)h(ar)n(e)i(distinguished)d(on)h(cr)n
(eation)h(by)g(the)f(type)g(of)63 3816 y(function)24
b(they)e(execute.)30 b(Undetached)22 b(thr)n(eads)h(execute)g(a)h
(function)g(which)g(has)g(a)h Fd(void*)63 3929 y Fg(r)n(eturn)20
b(type,)f(wher)n(eas)h(detached)f(thr)n(eads)h(execute)f(a)j(function)f
(which)g(has)g(a)g Fd(void)e Fg(r)n(eturn)63 4042 y(type.)50
b(Unfortunately)29 b(C++)i(member)g(functions)f(ar)n(e)h(not)f(allowed)
g(to)g(be)h(distinguished)63 4155 y(simply)26 b(by)h(their)f(r)n(eturn)
g(type.)38 b(Thus)26 b(in)h(the)f(case)h(of)g(a)g(derived)f(class)h(of)
f Fd(omni_thread)63 4268 y Fg(which)20 b(needs)e(an)j(undetached)d(thr)
n(ead,)i(the)f(member)h(function)g(executed)e(by)i(the)f(thr)n(ead)g
(is)63 4380 y(called)g Fd(run_undetached\(\))12 b Fg(rather)18
b(than)h Fd(run\(\))p Fg(,)e(and)i(it)g(is)g(started)e(by)i(calling)h
Fd(start_)63 4493 y(undetached\(\))d Fg(instead)22 b(of)g
Fd(start\(\))p Fg(.)204 4610 y(The)i(abstraction)i(curr)n(ently)e
(supports)f(thr)n(ee)h(priorities)g(of)h(thr)n(ead,)g(but)g(no)g
(guarantee)63 4722 y(is)33 b(made)g(of)h(how)f(this)g(will)h(af)n(fect)
h(underlying)d(thr)n(ead)h(scheduling.)59 b(The)33 b(thr)n(ee)f
(priori-)63 4835 y(ties)18 b(ar)n(e)i Fd(PRIORITY_LOW)p
Fg(,)14 b Fd(PRIORITY_NORMAL)f Fg(and)19 b Fd(PRIORITY_HIGH)p
Fg(.)13 b(By)19 b(default)g(all)63 4948 y(thr)n(eads)i(r)o(un)i(at)g
Fd(PRIORITY_NORMAL)o Fg(.)17 b(A)22 b(dif)n(fer)n(ent)h(priority)f(can)
i(be)e(speci\002ed)g(on)g(thr)n(ead)63 5061 y(cr)n(eation,)h(or)f
(while)h(the)f(thr)n(ead)g(is)h(r)o(unning)g(using)f
Fd(set_priority\(\).)g Fg(A)h(thr)n(ead's)f(cur)n(-)63
5174 y(r)n(ent)g(priority)g(is)g(r)n(eturned)f(by)i Fd(priority\(\))p
Fg(.)204 5290 y(Other)18 b(functions)g(pr)n(ovided)g(ar)n(e)h
Fd(self\(\))d Fg(which)j(r)n(eturns)e(the)h(calling)i(thr)n(ead's)e
Fd(omni_)63 5403 y(thread)34 b Fg(object,)40 b Fd(yield\(\))33
b Fg(which)38 b(r)n(equests)c(that)j(other)e(thr)n(eads)h(be)h(allowed)
g(to)f(r)o(un,)p eop end
%%Page: 4 4
TeXDict begin 4 3 bop 221 249 a Fg(4)1367 b Fe(6)91 b(THREADED)21
b(I/O)i(SHUTDOWN)f(FOR)g(UNIX)221 548 y Fd(id\(\))27
b Fg(which)i(r)n(eturns)e(an)i(integer)e(id)h(for)h(the)e(thr)n(ead)h
(for)g(use)g(in)h(debugging,)e Fd(state\(\))p Fg(,)221
661 y Fd(sleep\(\))20 b Fg(and)i Fd(get_time\(\))p Fg(.)221
953 y Fh(4)119 b(Per)n(-thread)28 b(data)221 1164 y Fg(omnithr)n(ead)22
b(supports)e(per)n(-thr)n(ead)h(data,)h(via)i(member)e(functions)f(of)i
(the)e Fd(omni_thread)221 1277 y Fg(object.)362 1390
y(First,)f(you)g(must)h(allocate)h(a)f(key)f(for)g(with)h(the)f
Fd(omni_thread::al)o(lo)o(cat)o(e_)o(ke)o(y\()o(\))221
1502 y Fg(function.)28 b(Then,)21 b(any)h(object)g(whose)f(class)h(is)g
(derived)f(fr)n(om)i Fd(omni_thread::va)o(lu)o(e_)o(t)221
1615 y Fg(can)k(be)f(stor)n(ed)e(using)h(the)h Fd(set_value\(\))21
b Fg(function.)38 b(V)-8 b(alues)25 b(ar)n(e)h(r)n(etrieved)f(or)h(r)n
(emoved)221 1728 y(with)d Fd(get_value\(\))17 b Fg(and)23
b Fd(remove_value\(\))16 b Fg(r)n(espectively)-10 b(.)362
1841 y(When)23 b(the)g(thr)n(ead)g(exits,)g(all)i(per)n(-thr)n(ead)e
(data)h(is)g(deleted)d(\(hence)j(the)e(base)i(class)g(with)221
1954 y(virtual)g(destr)o(uctor\).)362 2067 y(Note)17
b(that)i(the)f(per)n(-thr)n(ead)f(data)i(functions)f(ar)n(e)h
Fb(not)f Fg(thr)n(ead)g(safe,)i(so)d(although)i(you)e(can)221
2180 y(access)29 b(one)e(thr)n(ead's)h(storage)f(fr)n(om)i(another)f
(thr)n(ead,)h(ther)n(e)e(is)i(no)f(concurr)n(ency)g(contr)n(ol.)221
2293 y(Unless)j(you)g(r)n(eally)j(know)d(what)h(you)f(ar)n(e)i(doing,)g
(it)g(is)f(best)f(to)h(only)g(access)g(per)n(-thr)n(ead)221
2406 y(data)23 b(fr)n(om)g(the)f(thr)n(ead)g(it)h(is)g(attached)f(to.)
221 2698 y Fh(5)119 b(Using)31 b(OMNI)d(threads)h(in)h(your)g(program)
221 2909 y Fg(Obviously)18 b(you)f(need)g(to)g(include)h(the)e
Fd(omnithread.h)d Fg(header)j(\002le)i(in)g(your)f(sour)n(ce)g(code,)
221 3021 y(and)25 b(link)g(in)h(the)e(omnithr)n(ead)g(library)i(with)f
(your)f(executable.)34 b(Because)23 b(ther)n(e)h(is)h(a)g(single)221
3134 y Fd(omnithread.h)h Fg(for)32 b(all)h(platforms,)h(certain)e(pr)n
(epr)n(ocessor)d(de\002nes)h(must)h(be)g(given)h(as)221
3247 y(compiler)25 b(options.)31 b(The)23 b(easiest)g(way)h(to)g(do)f
(this)h(is)g(to)g(study)e(the)i(make\002les)f(given)h(in)h(the)221
3360 y(examples)i(pr)n(ovided)g(with)g(this)g(distribution.)42
b(If)27 b(you)g(ar)n(e)g(to)g(include)h(OMNI)f(thr)n(eads)g(in)221
3473 y(your)18 b(own)g(development)g(envir)n(onment,)h(these)e(ar)n(e)i
(the)f(necessary)g(pr)n(epr)n(ocessor)e(de\002nes:)p
362 3567 3287 4 v 360 3680 4 113 v 412 3646 a(Platform)p
1312 3680 V 599 w(Pr)n(epr)n(ocessor)21 b(De\002nes)p
3648 3680 V 362 3683 3287 4 v 362 3700 V 360 3813 4 113
v 412 3779 a(Sun)h(Solaris)h(2.x)p 1312 3813 V 365 w
Fd(-D__sunos__)50 b(-D__sparc__)f(-D__OSVERSION__)o(=5)p
3648 3813 V 360 3926 V 1312 3926 V 1363 3892 a(-DSVR4)j(-DUsePthread)d
(-D_REENTRANT)p 3648 3926 V 362 3929 3287 4 v 360 4042
4 113 v 412 4008 a Fg(x86)24 b(Linux)e(2.0)p 1312 4042
V 418 w Fd(-D__linux__)50 b(-D__i86__)g(-D__OSVERSION__)o(=2)p
3648 4042 V 360 4155 V 412 4121 a Fg(with)23 b(linuxthr)n(eads)f(0.5)p
1312 4155 V 100 w Fd(-D_REENTRANT)p 3648 4155 V 362 4158
3287 4 v 360 4271 4 113 v 412 4237 a Fg(Digital)i(Unix)f(3.2)p
1312 4271 V 320 w Fd(-D__osf1__)50 b(-D__alpha__)g(-D__OSVERSION_)o(_=)
o(3)p 3648 4271 V 360 4384 V 1312 4384 V 1363 4350 a(-D_REENTRANT)p
3648 4384 V 362 4387 3287 4 v 360 4500 4 113 v 412 4466
a Fg(W)-5 b(indows)22 b(NT)p 1312 4500 V 411 w Fd(-D__NT__)51
b(-MD)p 3648 4500 V 362 4503 3287 4 v 221 4740 a Fh(6)119
b(Threaded)29 b(I/O)g(shutdown)h(for)g(Unix)221 4951
y Fg(or)-7 b(,)20 b(how)e(one)g(thr)n(ead)h(should)f(tell)h(another)f
(thr)n(ead)g(to)h(shut)f(down)g(when)g(it)h(might)g(be)g(doing)221
5064 y(a)k(blocking)g(call)i(on)d(a)h(socket.)362 5177
y Fb(If)h(you)e(are)i(using)e(omniORB,)f(you)g(don')n(t)i(need)g(to)g
(worry)f(about)g(all)i(this,)f(since)h(om-)221 5290 y(niORB)i(does)h
(it)h(for)f(you.)39 b Fg(This)27 b(section)f(is)h(only)g(r)n(elevant)g
(if)h(you)e(ar)n(e)h(using)f(omnithr)n(ead)221 5403 y(in)d(your)f(own)g
(socket-based)f(pr)n(ogramming.)27 b(It)22 b(is)h(also)g(seriously)e
(out)h(of)h(date.)p eop end
%%Page: 5 5
TeXDict begin 5 4 bop 63 249 a Fe(6.1)91 b(r)n(ead\(\))2800
b Fg(5)204 548 y(Unfortunately)33 b(ther)n(e)g(doesn't)f(seem)h(to)h
(be)g(a)h(standar)n(d)e(way)i(of)f(doing)f(this)h(which)63
661 y(works)19 b(acr)n(oss)i(all)i(Unix)e(systems.)k(I)c(have)g
(investigated)f(the)h(behaviour)g(of)g(Solaris)h(2.5)g(and)63
774 y(Digital)k(Unix)g(3.2.)36 b(On)26 b(Digital)h(Unix)e(everything)f
(is)h(\002ne,)g(as)h(the)e(obvious)h(method)f(using)63
887 y(shutdown\(\))30 b(seems)h(to)h(work)f(OK.)h(Unfortunately)f(on)h
(Solaris)h(shutdown)d(can)j(only)f(be)63 1000 y(used)25
b(on)h(a)h(connected)e(socket,)g(so)h(we)g(need)f(devious)h(means)g(to)
g(get)f(ar)n(ound)h(this)g(limita-)63 1112 y(tion.)h(The)22
b(details)g(ar)n(e)h(summarised)g(below:)63 1429 y Fc(6.1)99
b(read\(\))63 1627 y Fg(Thr)n(ead)28 b(A)h(is)g(in)h(a)g(loop,)g(doing)
e Fd(read\(sock\))p Fg(,)e(pr)n(ocessing)h(the)i(data,)h(then)f(going)f
(back)63 1739 y(into)22 b(the)g(r)n(ead.)204 1862 y(Thr)n(ead)30
b(B)h(comes)f(along)h(and)g(wants)f(to)g(shut)g(it)h(down)f(\227)h(it)g
(can't)g(cancel)h(thr)n(ead)f(A)63 1975 y(since)21 b(\(i\))h(working)e
(out)g(how)g(to)h(clean)h(up)e(accor)n(ding)i(to)e(wher)n(e)g(A)h(is)g
(in)h(its)f(loop)f(is)h(a)h(night-)63 2088 y(mar)n(e,)h(and)f(\(ii\))i
(this)f(isn't)f(available)k(in)d(omnithr)n(ead)f(anyway)-10
b(.)204 2211 y(On)23 b(Solaris)g(2.5)g(and)g(Digital)h(Unix)f(3.2)g
(the)f(following)h(strategy)d(works:)204 2334 y(Thr)n(ead)i(B)g(does)f
Fd(shutdown\(sock,2)o(\))p Fg(.)204 2457 y(At)h(this)g(point)h(thr)n
(ead)f(A)g(is)h(either)f(blocked)g(inside)h Fd(read\(sock\))p
Fg(,)18 b(or)k(is)h(elsewher)n(e)e(in)63 2570 y(the)d(loop.)26
b(If)18 b(the)g(former)h(then)f(r)n(ead)h(will)h(r)n(eturn)e(0,)i
(indicating)f(that)g(the)f(socket)f(is)i(closed.)26 b(If)63
2683 y(the)21 b(latter)h(then)f(eventually)h(thr)n(ead)g(A)g(will)i
(call)g Fd(read\(sock\))17 b Fg(and)23 b(then)e(this)h(will)h(r)n
(eturn)63 2796 y(0.)28 b(Thr)n(ead)22 b(A)h(should)e
Fd(close\(sock\))p Fg(,)d(do)k(any)g(other)g(tidying)f(up,)h(and)h
(exit.)204 2919 y(If)34 b(ther)n(e)g(is)h(another)f(point)g(in)h(the)e
(loop)i(that)f(thr)n(ead)g(A)h(can)g(block)g(then)f(obviously)63
3032 y(thr)n(ead)19 b(B)h(needs)f(to)h(be)g(awar)n(e)h(of)f(this)g(and)
g(be)h(able)g(to)e(wake)h(it)h(up)f(in)g(the)g(appr)n(opriate)g(way)63
3145 y(fr)n(om)j(that)f(point.)63 3462 y Fc(6.2)99 b(accept\(\))63
3659 y Fg(Again)25 b(thr)n(ead)g(A)h(is)f(in)h(a)g(loop,)g(this)f(time)
h(doing)e(an)i(accept)g(on)f(listenSock,)g(dealing)h(with)63
3772 y(a)d(new)f(connection)g(and)h(going)e(back)j(into)e(accept.)28
b(Thr)n(ead)22 b(B)g(wants)h(to)f(cancel)h(it.)204 3895
y(On)g(Digital)h(Unix)f(3.2)g(the)f(strategy)e(is)j(identical)h(to)e
(that)g(for)h(r)n(ead:)204 4018 y(Thr)n(ead)39 b(B)g(does)f
Fd(shutdown\(listen)o(So)o(ck)o(,2)o(\))p Fg(.)73 b(Wher)n(ever)38
b(thr)n(ead)h(A)h(is)f(in)h(the)63 4131 y(loop,)i(eventually)c(it)h
(will)h(r)n(eturn)e Fd(ECONNABORTED)c Fg(fr)n(om)39 b(the)f(accept)h
(call.)78 b(It)39 b(should)63 4244 y Fd(close\(listenSo)o(ck)o(\))p
Fg(,)16 b(tidy)22 b(up)g(as)h(necessary)e(and)i(exit.)204
4367 y(On)30 b(Solaris)f(2.5)i(thr)n(ead)e(B)g(can't)h(do)f
Fd(shutdown\(liste)o(nS)o(oc)o(k,2)o(\))23 b Fg(\227)30
b(this)f(r)n(eturns)63 4480 y Fd(ENOTCONN)p Fg(.)18 b(Instead)j(the)h
(following)h(strategy)e(can)i(be)g(used:)204 4603 y(First)35
b(thr)n(ead)h(B)g(sets)e(some)h(sort)g(of)h("shutdown)e(\003ag")i
(associated)g(with)g(listenSock.)63 4716 y(Then)31 b(it)h(does)e
Fd(getsockaddr\(lis)o(te)o(nS)o(ock)o(\))c Fg(to)31 b(\002nd)g(out)g
(which)i(port)e(listenSock)f(is)63 4828 y(on)18 b(\(or)h(knows)e(alr)n
(eady\),)j(sets)d(up)h(a)h(socket)e(dummySock,)i(does)e
Fd(connect\(dummyS)o(oc)o(k,)63 4941 y(this)52 b(host,)h(port\))20
b Fg(and)j(\002nally)g(does)e Fd(close\(dummySock)o(\))p
Fg(.)204 5064 y(Wher)n(ever)16 b(thr)n(ead)h(A)g(is)g(in)h(the)e(loop,)
h(eventually)g(it)h(will)g(call)h Fd(accept\(listenSo)o(ck)o(\))p
Fg(.)63 5177 y(This)35 b(will)j(r)n(eturn)d(successfully)g(with)h(a)h
(new)e(socket,)j(say)e(connSock.)67 b(Thr)n(ead)36 b(A)f(then)63
5290 y(checks)20 b(to)h(see)f(if)i(the)f("shutdown)e(\003ag")j(is)f
(set.)26 b(If)c(not,)e(then)h(it's)g(a)h(normal)g(connection.)27
b(If)21 b(it)63 5403 y(is)h(set,)g(then)f(thr)n(ead)h(A)h(closes)f
(listenSock)f(and)i(connSock,)e(tidies)h(up)g(and)h(exits.)p
eop end
%%Page: 6 6
TeXDict begin 6 5 bop 221 249 a Fg(6)1367 b Fe(6)91 b(THREADED)21
b(I/O)i(SHUTDOWN)f(FOR)g(UNIX)221 548 y Fc(6.3)99 b(write\(\))221
768 y Fg(Thr)n(ead)19 b(A)f(may)h(be)g(blocked)f(in)i(write,)f(or)f
(about)h(to)f(go)g(in)h(to)g(a)g(potentially-blocking)g(write.)221
881 y(Thr)n(ead)j(B)h(wants)f(to)g(shut)f(it)i(down.)362
1016 y(On)g(Solaris)g(2.5:)362 1150 y(Thr)n(ead)f(B)h(does)e
Fd(shutdown\(sock,)o(2\))o Fg(.)362 1285 y(If)e(thr)n(ead)f(A)h(is)g
(alr)n(eady)g(in)h Fd(write\(sock\))13 b Fg(then)18 b(it)h(will)i(r)n
(eturn)d(with)g Fd(ENXIO)p Fg(.)f(If)i(thr)n(ead)221
1398 y(A)k(calls)h(write)e(after)g(thr)n(ead)g(B)h(calls)h(shutdown)c
(this)i(will)i(r)n(eturn)e Fd(EIO)p Fg(.)362 1532 y(On)h(Digital)h
(Unix)f(3.2:)362 1666 y(Thr)n(ead)f(B)h(does)e Fd(shutdown\(sock,)o
(2\))o Fg(.)362 1801 y(If)j(thr)n(ead)f(A)g(is)h(alr)n(eady)g(in)g
Fd(write\(sock\))19 b Fg(then)j(it)i(will)h(r)n(eturn)e(the)f(number)i
(of)f(bytes)221 1914 y(written)31 b(befor)n(e)h(it)g(became)g(blocked.)
55 b(A)32 b(subsequent)d(call)34 b(to)d(write)h(will)h(then)e(generate)
221 2027 y Fd(SIGPIPE)20 b Fg(\(or)i Fd(EPIPE)f Fg(will)j(be)e(r)n
(eturned)f(if)j Fd(SIGPIPE)19 b Fg(is)k(ignor)n(ed)e(by)i(the)f(thr)n
(ead\).)221 2413 y Fc(6.4)99 b(connect\(\))221 2634 y
Fg(Thr)n(ead)30 b(A)f(may)h(be)g(blocked)f(in)i(connect,)g(or)e(about)h
(to)f(go)g(in)i(to)e(a)h(potentially-blocking)221 2747
y(connect.)d(Thr)n(ead)c(B)f(wants)g(to)g(shut)g(it)g(down.)362
2881 y(On)h(Digital)h(Unix)f(3.2:)362 3016 y(Thr)n(ead)f(B)h(does)e
Fd(shutdown\(sock,)o(2\))o Fg(.)362 3150 y(If)26 b(thr)n(ead)f(A)g(is)h
(alr)n(eady)g(in)g Fd(connect\(sock\))20 b Fg(then)k(it)i(will)h(r)n
(eturn)e(a)h(successful)f(con-)221 3263 y(nection.)54
b(Subsequent)29 b(r)n(eading)i(or)g(writing)g(will)i(show)d(that)i(the)
e(socket)g(has)h(been)g(shut)221 3376 y(down)22 b(\(i.e.)28
b(r)n(ead)23 b(r)n(eturns)e(0,)i(write)f(generates)f
Fd(SIGPIPE)e Fg(or)j(r)n(eturns)g Fd(EPIPE)p Fg(\).)e(If)j(thr)n(ead)f
(A)221 3489 y(calls)i(connect)e(after)h(thr)n(ead)f(B)g(calls)i
(shutdown)d(this)h(will)i(r)n(eturn)e Fd(EINVAL)p Fg(.)362
3623 y(On)h(Solaris)g(2.5:)362 3758 y(Ther)n(e)35 b(is)h(no)f(way)g(to)
g(wake)g(up)g(a)h(thr)n(ead)f(which)h(is)g(blocked)f(in)h(connect.)66
b(Instead)221 3871 y(Solaris)33 b(for)n(ces)g(us)f(thr)n(ough)g(a)i
(ridiculous)f(pr)n(ocedur)n(e)e(whichever)i(way)g(we)f(try)g(it.)59
b(One)221 3984 y(way)23 b(is)f(this:)362 4118 y(First)d(thr)n(ead)h(A)g
(cr)n(eates)f(a)h(pipe)g(in)g(addition)g(to)f(the)g(socket.)25
b(Instead)19 b(of)h(shutting)e(down)221 4231 y(the)k(socket,)f(thr)n
(ead)h(B)g(simply)h(writes)e(a)i(byte)f(to)g(the)g(pipe.)362
4365 y(Thr)n(ead)17 b(A)g(meanwhile)h(sets)d(the)i(socket)e(to)i
(non-blocking)g(mode)f(using)h Fd(fcntl\(sock,)221 4478
y(F_SETFL,)51 b(O_NONBLOCK\))p Fg(.)22 b(Then)27 b(it)g(calls)i
(connect)e(on)g(the)f(socket)g(\227)h(this)g(will)i(r)n(eturn)221
4591 y Fd(EINPROGRESS)p Fg(.)g(Then)34 b(it)h(must)e(call)k
Fd(select\(\))p Fg(,)c(waiting)i(for)f(either)g(sock)g(to)f(become)221
4704 y(writable)39 b(or)f(for)h(the)e(pipe)h(to)g(become)g(r)n
(eadable.)75 b(If)39 b(select)e(r)n(eturns)g(that)i(just)e(sock)h(is)
221 4817 y(writable)30 b(then)f(the)g(connection)g(has)h(succeeded.)47
b(It)29 b(then)g(needs)f(to)h(set)f(the)h(socket)f(back)221
4930 y(to)i(blocking)h(mode)f(using)g Fd(fcntl\(sock,)50
b(F_SETFL,)h(0\))p Fg(.)g(If)31 b(instead)e(select)h(r)n(eturns)221
5043 y(that)23 b(the)e(pipe)h(is)h(r)n(eadable,)g(thr)n(ead)f(A)h
(closes)e(the)h(socket,)f(tidies)h(up)g(and)h(exits.)362
5177 y(An)g(alternative)h(method)e(is)i(similar)h(but)e(to)g(use)f
(polling)i(instead)e(of)i(the)e(pipe.)29 b(Thr)n(ead)221
5290 y(B)24 b(justs)e(sets)g(a)j(\003ag)f(and)g(thr)n(ead)f(A)h(calls)h
(select)e(with)g(a)i(timeout,)e(periodically)h(waking)f(up)221
5403 y(to)f(see)g(if)h(the)f(\003ag)h(has)f(been)g(set.)p
eop end
%%Page: 7 7
TeXDict begin 7 6 bop 63 249 a Fe(REFERENCES)2658 b Fg(7)63
548 y Fh(References)63 759 y Fg([POSIX94])46 b Fa(Portable)29
b(Operating)h(System)e(Interface)h(\(POSIX\))e(Thr)n(eads)j(Extension)p
Fg(,)f(P1003.1c)245 872 y(Draft)23 b(10,)g(IEEE,)e(September)g(1994.)63
1059 y([Birr)n(ell89])47 b Fa(An)28 b(Intr)n(oduction)i(to)f(Pr)n
(ogramming)i(with)e(Thr)n(eads)p Fg(,)j(Resear)n(ch)c(Report)e(35,)31
b(DEC)245 1172 y(Systems)20 b(Resear)n(ch)i(Center)-7
b(,)22 b(Palo)h(Alto,)f(CA,)h(January)g(1989.)p eop end
%%Trailer

userdict /end-hook known{end-hook}if
%%EOF
